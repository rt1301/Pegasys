<%-include("partials/header.ejs")%>
<%if(rocket){%>
  <div class="container-fluid" id="image" style="background-image: url('<%=rocket.img1%>');background-size: cover;background-repeat: no-repeat; margin-bottom: 5%;">
      <div class="display-2" style="padding-top:20%;text-align: center;font-weight: 700;text-transform: uppercase;"><%=rocket.Name%></div>
      <div style="text-align: center;font-weight: 500;font-size: 2.1em;text-transform: uppercase;"><%=rocket.Tagline%></div>
  </div>
  <div class="container-fluid" id="table" style="height:100%;">
     <div class="row" style="width:100%;height:100%;">
         <div class="col-lg-6">
          <div class="container" style="margin: 20% auto;">
            <div class="display-5" style="padding-left: 10%; font-size: large;"><%=rocket.Name%></div>
            <div class="display-3" style="padding-left: 10%;">Overview</div>
            <table class="data">
              <tr>
                  <td>Height</td>
                  <td><%=rocket.Height%></td>
              </tr>
              <tr>
                  <td>Diameter</td>
                  <td><%=rocket.Diameter%></td>
              </tr>
              <tr>
                  <td>Mass</td>
                  <td><%=rocket.Mass%></td>
              </tr>
              <tr>
                  <td>LEO</td>
                  <td><%=rocket.LEO%></td>
              </tr>
              <tr>
                  <td>GTO</td>
                  <td><%=rocket.GTO%></td>
              </tr>
          </table>
          </div>
         </div>
         <div class="col-lg-6" id="scene"></div>
     </div>
  </div>
<div class="container-fluid"  id="animation" style="height: 100%;">
<div class="row" style="width:100%;height:100%;">
  <div class="col-md-8">
    <video autoplay loop muted width="100%" height="100%" preload="auto" autobuffer="true">
      <source src="/Animations/<%=rocket.Name%>.webm" type="video/webm">
      <source src="/Animations/<%=rocket.Name%>.mp4" type="video/mp4">
    </video>
  </div>
  <div class="col-md-4">
   <div class="container" style="margin-top: 40%; margin-bottom: 10%;">
    <div class="display-4" style="font-size: 2.5rem;font-weight: 600;"><%=rocket.Header%></div>
    <br>
    <%-rocket.Content%>
   </div>
  </div>
</div>
</div>
<div class="container-fluid" id="slides" >
<div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
    <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
  </ol>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="<%=rocket.img2%>" class="d-block w-100" style="height: 800px;">
      <div class="carousel-caption d-none d-md-block">
       <p><%=rocket.desc1%></p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="<%=rocket.img3%>" class="d-block w-100" style="height: 800px;">
      <div class="carousel-caption d-none d-md-block">
        <p><%=rocket.desc2%></p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="<%=rocket.img4%>" class="d-block w-100" style="height: 800px;">
      <div class="carousel-caption d-none d-md-block">
        <p><%=rocket.desc3%></p>
      </div>
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
</div>
<script src="/js/three.min.js"></script>
<script src="/js/GLTFLoader.js"></script>
<script src="/js/OrbitControls.js"></script>
<% var cx,cy,cz;
cx = rocket.Camera_x;
cy = rocket.Camera_y;
cz = rocket.Camera_z;
var pos = rocket.Position;
%>
<!-- Three js animation script -->
<script>
// Scroll Animation
var tl = new TimelineMax();
var tl1 = new TimelineMax();
var tl2 = new TimelineMax();
const controller = new ScrollMagic.Controller();
tl.from("#table",0.5,{scale:0,opacity:0},"+=0.3");
tl1.from("#animation",1,{scale:0,opacity:0});
tl2.from("#slides",1,{scale:0,opacity:0});

const ScrollScene1 = new ScrollMagic.Scene({
  triggerElement: "#table",
  triggerHook: "onEnter",
}).setTween(tl).addTo(controller);
const ScrollScene2 = new ScrollMagic.Scene({
  triggerElement: "#animation",
  triggerHook: "onEnter",
}).setTween(tl1).addTo(controller);

var size =
{
    height: window.innerHeight,
    width: window.innerWidth,
}
    // div alignment
    $("#table").css("height",window.innerHeight);
    $("#table").css("width",window.innerWidth);
    $("#image").css("height",window.innerHeight);
    $("#image").css("width",window.innerWidth);
    $("#animation").css("height",window.innerHeight);
    $("#animation").css("width",window.innerWidth);
    $("#first").css("line-height","1.8em");
    $("#first").addClass("lead");
    $("#slide").css("height",window.innerHeight-500);
    $("#slide").css("width",window.innerWidth);
// Threejs code
    //Variables for setup
    let container;
    let camera;
    let renderer;
    let scene;
    var rocket;
    var controls;
    
    function init() {
      container = document.querySelector("#scene");
    
      //Create scene
      scene = new THREE.Scene();
    
      const fov = 35;
      const aspect = container.clientWidth / container.clientHeight;
      const near = 0.1;
      const far = 1000;
      
      //Camera setup
      camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
      camera.position.set(<%=cx%>, <%=cy%>, <%=cz%>);
    console.log(<%=cx%>, <%=cy%>, <%=cz%>)
      const ambient = new THREE.AmbientLight(0x404040, 2);
      scene.add(ambient);
    
      const light = new THREE.DirectionalLight(0xffffff, 2);
      light.position.set(50, 50, 100);
      scene.add(light);
      //Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
    
      container.appendChild(renderer.domElement);
    // Controls
      controls = new THREE.OrbitControls(camera,renderer.domElement);
      //Load Model
      let loader = new THREE.GLTFLoader();
      loader.load("/models/<%=rocket.Name%>.gltf", function(gltf) {
        scene.add(gltf.scene);
        rocket = gltf.scene.children[0];
        rocket.position.y = <%=pos%>;
        rocket.position.x = 0;
        rocket.position.z = 0;
        animate();
      });
    }
    
    function animate() {
      requestAnimationFrame(animate);
      rocket.rotation.y += 0.01;
      rocket.castShadow = true;
      renderer.render(scene, camera);
    }
    
    init();
    
    function onWindowResize() {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
    
      renderer.setSize(container.clientWidth, container.clientHeight);
    }
    
    window.addEventListener("resize", onWindowResize);
    
</script>
<%}%>
<%-include("partials/footer.ejs")%>